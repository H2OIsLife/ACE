---
title: "counts to %ab"
author: "Jordyn Stoll"
date: "March 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#SPECIES COUNTS
maumee<- read.csv("~/Desktop/USGS/Maumee Species Counts.csv")
str(maumee)
nerie<-read.csv("~/Desktop/USGS/NEspeciescounts .csv")
str(nerie)
ford<-read.csv("~/Desktop/USGS/Ford Compilation - species.csv")
str(ford)
greenbay<-read.csv("~/Desktop/USGS/GB species counts.csv")
str(greenbay)
#DIVISONS COUNTS


```
Create a loop to transform from counts to percent abundance
```{r}
#previous loop to work with

#so, I need to create a matrix to store the loop results in
# create a loop that takes counts from columns 4-70 and divides each number by the corresponding 'total counted' in column 3. Then store that in the matrix
#Christie's code

#MAUMEE
for (i in 4:70){
 #extract name of column i, add, '.prop' to it in a text string
 vecname<-paste(colnames(maumee[i]), ".prop", sep="")
 #do the proportion calculation, put it in a new vector
 newvec<-maumee[i]/maumee$Total.counted
 #bind that new vector to the maumee data frame
 maumee<-cbind(maumee, newvec)
 #the number of the new column is i +67, becayse we started counting i at 4 and there are 70 columns
 columnnum<-i+67
 #rename newly created column with vecname
 colnames(maumee)[columnnum] <- vecname
}

#NORTH ERIE
for (i in 5:147){
 vecname2<-paste(colnames(nerie[i]), ".prop", sep="")
 newvec2<-nerie[i]/nerie$Total
 nerie<-cbind(nerie, newvec2)
 columnnum<-i+143
 colnames(nerie)[columnnum] <- vecname2
}
#GREENBAY
for (i in 5:52){
 vecname3<-paste(colnames(greenbay[i]), ".prop", sep="")
 newvec3<-greenbay[i]/greenbay$Total.Counted
 greenbay<-cbind(greenbay, newvec3)
 columnnum<-i+48
 colnames(greenbay)[columnnum] <- vecname3
}
#FORD
for (i in 4:80){
 vecname4<-paste(colnames(ford[i]), ".prop", sep="")
 newvec4<-ford[i]/ford$Total.counted
 ford<-cbind(ford, newvec4)
 columnnum<-i+77
 colnames(ford)[columnnum] <- vecname4
}

```

#Plot Microcystis Abundance to Treatment
```{r}
library(plyr)
#MAUMEE
maumee$Treatment <- factor(maumee$Treatment,levels=c("Initial","Control","Nitrogen","Phosphorus", "Trace","N+P","N+Trace","P+Trace","N+P+Trace","Chelex"))

summarystatsMicro<- ddply(maumee, "Treatment", summarize,
                     Microcystis.spp..mean=mean(Microcystis.spp..prop),
                     Microcystis.spp..sd=sd(Microcystis.spp..prop),
                     Microcystis.spp..se=sd(Microcystis.spp..prop)/sqrt(length(Microcystis.spp..prop)))
library(ggplot2)
Microsummaryplot<-ggplot(summarystatsMicro, aes(Treatment, Microcystis.spp..mean, fill=Treatment))+ 
  geom_bar(stat='identity',color='black')+
  geom_errorbar(aes(ymin=Microcystis.spp..mean-Microcystis.spp..se, ymax=Microcystis.spp..mean+Microcystis.spp..se))+
  theme(axis.text.x=element_text(angle = 45, hjust=1))+
  ggtitle("Maumee Microcystis spp. % Abundance")

Microsummaryplot


#NORTH ERIE
nerie$Treatment <- factor(nerie$Treatment,levels=c("Initial","Control","Nitrogen","Phosphorus", "Trace","N+P","N+Trace","P+Trace","N+P+Trace","Chelex"))

summarystatsMicro1<- ddply(nerie, "Treatment", summarize,
                     Microcystis.spp..mean=mean(Microcystis.spp..prop),
                     Microcystis.spp..sd=sd(Microcystis.spp..prop),
                     Microcystis.spp..se=sd(Microcystis.spp..prop)/sqrt(length(Microcystis.spp..prop)))

Microsummaryplot1<-ggplot(summarystatsMicro1, aes(Treatment, Microcystis.spp..mean, fill=Treatment))+ 
  geom_bar(stat='identity',color='black')+
  geom_errorbar(aes(ymin=Microcystis.spp..mean-Microcystis.spp..se, ymax=Microcystis.spp..mean+Microcystis.spp..se))+
  theme(axis.text.x=element_text(angle = 45, hjust=1))+
  ggtitle("North Erie Microcystis spp. % Abundance")

Microsummaryplot1

#GREEN BAY
greenbay$Treatment <- factor(greenbay$Treatment,levels=c("Initial","Control","Nitrogen","Phosphorus", "Trace","N+P","N+Trace","P+Trace","N+P+Trace","Chelex"))

greenbay$Microcystis.spp..prop

summarystatsMicro2<- ddply(greenbay, "Treatment", summarize,
                     Microcystis.spp..mean=mean(Microcystis.spp..prop),
                     Microcystis.spp..sd=sd(Microcystis.spp..prop),
                     Microcystis.spp..se=sd(Microcystis.spp..prop)/sqrt(length(Microcystis.spp..prop)))

Microsummaryplot2<-ggplot(summarystatsMicro2, aes(Treatment, Microcystis.spp..mean, fill=Treatment))+ 
  geom_bar(stat='identity',color='black')+
  geom_errorbar(aes(ymin=Microcystis.spp..mean-Microcystis.spp..se, ymax=Microcystis.spp..mean+Microcystis.spp..se))+
  theme(axis.text.x=element_text(angle = 45, hjust=1))+
  ggtitle("Green Bay Microcystis spp. % Abundance")

Microsummaryplot2


#FORD
ford$Treatment <- factor(ford$Treatment,levels=c("Initial","Control","Nitrogen","Phosphorus", "Trace","N+P","N+Trace","P+Trace","N+P+Trace","Chelex"))


summarystatsMicro3<- ddply(ford, "Treatment", summarize,
                     Microcystis.spp..mean=mean(Microcystis.spp..prop),
                     Microcystis.spp..sd=sd(Microcystis.spp..prop),
                     Microcystis.spp..se=sd(Microcystis.spp..prop)/sqrt(length(Microcystis.spp..prop)))

Microsummaryplot3<-ggplot(summarystatsMicro3, aes(Treatment, Microcystis.spp..mean, fill=Treatment))+ 
  geom_bar(stat='identity',color='black')+
  geom_errorbar(aes(ymin=Microcystis.spp..mean-Microcystis.spp..se, ymax=Microcystis.spp..mean+Microcystis.spp..se))+
  theme(axis.text.x=element_text(angle = 45, hjust=1))+
  ggtitle("Ford Microcystis spp. % Abundance")

Microsummaryplot3

```



```










To look at the effect of the nutrient treatments on Microcystis abundance
```{r}
plot(Microcystis.spp..prop~Treatment, data=maumee, main='Microcystis Abundance to Nutrient Treatment', ylab='Microcystis % Abundance',las=3)
MicrocystisANOVA<-aov(Microcystis.spp.~Treatment, data=MaumeeMesoComData)
shapiro.test(resid(MicrocystisANOVA))
par(mfrow=c(1,2))
plot(MicrocystisANOVA, which=c(1,2))
summary(MicrocystisANOVA)
TukeyHSD(MicrocystisANOVA)
```